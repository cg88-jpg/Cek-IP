<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Multi-Fungsi</title>
    <style>
        /* ==================== A. CSS DASAR & BACKGROUND ==================== */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            /* Background Gambar Naga dari Cek IP (dipertahankan) */
            background-image: url('https://infomancingduit.com/wp-content/uploads/2024/12/MANCING.png');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            display: flex;
            min-height: 100vh;
            color: #444;
        }
        /* ==================== B. CSS SIDEBAR/MENU ==================== */
        #sidebar {
            width: 250px;
            background-color: rgba(34, 34, 34, 0.95);
            padding: 20px 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100%;
            color: white;
            z-index: 100;
        }
        /* CSS BARU UNTUK LOGO */
        #sidebar .logo {
            width: 80%;
            height: auto;
            margin: 0 auto 15px auto;
            display: block;
        }
        #sidebar h2 {
            text-align: center;
            color: #FFD700;
            margin-bottom: 30px;
            text-shadow: 0 0 5px #FFD700;
        }
        .menu-item {
            padding: 15px 20px;
            text-decoration: none;
            color: white;
            font-weight: bold;
            border-bottom: 1px solid #333;
            transition: background-color 0.3s, color 0.3s;
            cursor: pointer;
        }
        .menu-item:hover, .menu-item.active {
            background-color: #555;
            color: #FFD700;
        }
        /* ==================== C. CSS KONTEN UTAMA (Container) ==================== */
        #main-container {
            flex-grow: 1;
            margin-left: 250px;
            padding: 20px;
            box-sizing: border-box;
        }
        .content-panel {
            max-width: 1000px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        /* ==================== D. CSS CEK IP ==================== */
        h1 { color: #222; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        textarea#logInput { width: 100%; height: 200px; padding: 10px; box-sizing: border-box; margin-bottom: 10px; }
        button#btn-cek-ip { padding: 10px 20px; background-color: #28a745; color: white; border: none; cursor: pointer; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #e0e6ed; }
        .high-count { background-color: #ffcccc; font-weight: bold; }
        #running-text { padding: 10px 0; margin-bottom: 20px; border-bottom: 2px solid #ccc; }
        .glowing-text {
            font-size: 1.5em; font-weight: bold;
            text-shadow: 0 0 5px rgba(255, 255, 255, 1), 0 0 10px rgba(255, 255, 255, 0.8), 0 0 15px currentColor, 0 0 20px currentColor;
        }
        /* ==================== E. CSS PREDIKSI BOLA ==================== */
        #content-prediksi-bola {
            background: rgba(0, 0, 0, 0.85); 
            color: white;
        }
        #content-prediksi-bola h2 {
            color: #FFD700;
            text-shadow: 0 0 8px #FFD700, 0 0 15px #FFD700;
            margin-bottom: 20px;
        }
        #content-prediksi-bola textarea {
            width: calc(100% - 20px); height: 150px; margin-bottom: 10px; border-radius: 5px; padding: 10px; resize: vertical;
            background: #222; color: #eee; border: 1px solid #555;
        }
        #content-prediksi-bola button {
            background: #FFD700; color: black; border: none; padding: 10px 25px; margin: 5px; cursor: pointer;
            font-weight: bold; border-radius: 5px; transition: background 0.3s ease, box-shadow 0.3s ease; box-shadow: 0 0 5px #FFD700;
        }
        #content-prediksi-bola button:hover { background: #FFE066; box-shadow: 0 0 10px #FFD700; }
        #htmlOutput { height: 300px; background: #111; color: #0f0; font-family: 'Consolas', 'Monaco', monospace; border: 1px solid #333; }
        .match-block {
            background: #1a1a1a; color: white; border-radius: 5px; margin: 25px auto; padding: 0; width: 100%; max-width: 700px;
            overflow: hidden; box-shadow: 0 0 15px rgba(0,0,0,0.7);
        }
        .match-block .league-title {
            background: #000000; color: #f6ff00; padding: 10px 15px; margin: 0; text-align: center;
            font-size: 1em; font-weight: bold; text-transform: uppercase; text-shadow: 0 0 6px #FFFF00;
        }
        .match-block thead th {
            background: #fffb00; color: #000; font-weight: bold; padding: 8px 12px; border: 1px solid #444; text-align: center;
        }
        .match-block tbody td {
            background: #111; color: #fff; padding: 8px 12px; border: 1px solid #444; text-align: center;
        }
        /* ==================== F. CSS HISTORY CEK IP (BARU/MODIFIED) ==================== */
        #content-history-cek-ip h2 { color: #007bff; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        #content-history-cek-ip button { 
            background-color: #dc3545;
            color: white; 
            border: none; 
            padding: 10px 15px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }
        #content-history-cek-ip button:hover {
            background-color: #c82333;
        }
        #content-history-cek-ip table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        #content-history-cek-ip th, #content-history-cek-ip td { border: 1px solid #ccc; padding: 10px; text-align: left; }
        #content-history-cek-ip th { background-color: #f2f2f2; color: #333; font-weight: bold; }
        .status-cek { background-color: #ffcccc; font-weight: bold; }
        .status-normal { background-color: #e8f5e9; }
        
        /* CSS Tambahan untuk detail history */
        .history-detail-toggle {
            cursor: pointer;
            color: #007bff;
            font-weight: bold;
            user-select: none;
        }
        .history-detail-table {
            width: 95%;
            margin: 10px auto 10px 10px;
            border: 1px dashed #aaa;
            display: none; /* Sembunyikan secara default */
            font-size: 0.9em;
        }
        .history-detail-table th, .history-detail-table td {
            padding: 5px;
            border: 1px solid #eee;
        }
        .history-detail-table .high-count-detail {
            background-color: #f8d7da; /* Warna merah muda lebih lembut */
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <img src="https://i.postimg.cc/8PMP5890/logo.png" alt="Logo Mancing Duit" class="logo">
        
        <a href="#" class="menu-item active" data-content="cek-ip" id="menu-cek-ip">üîç Cek IP</a>
        <a href="#" class="menu-item" data-content="history-cek-ip" id="menu-history-cek-ip">üìú HISTORY CEK IP</a>
        <a href="#" class="menu-item" data-content="prediksi-bola" id="menu-prediksi-bola">‚öΩ PREDIKSI BOLA</a>
    </div>
    <div id="main-container">
        <div id="content-cek-ip" class="content-panel">
            <div id="running-text">
                <marquee behavior="scroll" direction="left" scrollamount="10">
                    <span class="glowing-text">
                        <span style="color: #FF0000;">C</span> <span style="color: #FF00FF;">E</span> <span style="color: #00FFFF;">K</span> <span style="color: #00FF00;">&nbsp;IP</span> <span style="color: #0000FF;">&nbsp;S</span> <span style="color: #4B0082;">E</span> <span style="color: #FF0000;">T</span> <span style="color: #FF00FF;">I</span> <span style="color: #00FFFF;">A</span> <span style="color: #00FF00;">P</span> <span style="color: #0000FF;">&nbsp;1</span> <span style="color: #4B0082;">&nbsp;J</span> <span style="color: #FF0000;">A</span> <span style="color: #FF00FF;">M</span> <span style="color: #00FFFF;">&nbsp;S</span> <span style="color: #00FF00;">E</span> <span style="color: #0000FF;">K</span> <span style="color: #4B0082;">A</span> <span style="color: #FF0000;">L</span> <span style="color: #FF00FF;">I</span> </span>
                </marquee>
            </div>
            <h1>üîç Dashboard Analisis IP Login</h1>
            <p>‚úÖTempelkan data Anda di bawah ini. Tekan F5 untuk membersihkan input.</p>
            <textarea id="logInput" placeholder="Tempelkan data Anda di sini..."></textarea>
            <button onclick="processData()" id="btn-cek-ip">Klik Disini</button>
            <div id="results">
                <p>Tempelkan data Anda dan tekan "Klik Disini".</p>
            </div>
        </div>
        
        <div id="content-history-cek-ip" class="content-panel" style="display: none;">
            <h2>üìú Riwayat Pengecekan IP</h2>
            <button onclick="clearHistory()">Hapus Semua Riwayat</button>
            <p style="font-style: italic; color: #555;">(Data riwayat ini menyimpan detail dan tersimpan **Lokal** di browser Anda. Tidak dapat dilihat oleh pengguna lain.)</p>
            <div id="history-results">
                <p>Belum ada riwayat pengecekan IP yang tersimpan.</p>
            </div>
        </div>
        
        <div id="content-prediksi-bola" class="content-panel" style="display: none;">
            <h2>PREDIKSI BOLA</h2>
            <textarea id="input" placeholder="Masukkan pertandingan di sini..."></textarea><br>
            <button onclick="generateTable()">GENERATE TABEL</button>
            <button onclick="copyHTML()">COPY SEMUA HTML</button>
            <div id="output"></div>
            <h3 class="hasil-html">üìã Hasil HTML Disini:</h3>
            <textarea id="htmlOutput" readonly></textarea>
        </div>
    </div>
    <script>
        // Key untuk menyimpan riwayat di localStorage
        const HISTORY_STORAGE_KEY = 'ipCheckHistoryV2';
        
        // --- 1. SCRIPT PENGATUR MENU (CONTENT SWITCHING) ---
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Hapus kelas 'active' dari semua menu
                document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
                
                // Tambahkan kelas 'active' ke menu yang diklik
                this.classList.add('active');
                // Sembunyikan semua panel konten
                document.querySelectorAll('.content-panel').forEach(p => p.style.display = 'none');
                
                // Tampilkan panel konten yang sesuai
                const targetId = 'content-' + this.getAttribute('data-content');
                const targetPanel = document.getElementById(targetId);
                if (targetPanel) {
                    targetPanel.style.display = 'block';
                }
                
                // PANGGIL FUNGSI UNTUK MEMUAT RIWAYAT JIKA MENU HISTORY DIPILIH
                if (this.getAttribute('data-content') === 'history-cek-ip') {
                    loadHistory();
                }
            });
        });
        
        // --- 2. SCRIPT RESET INPUT KETIKA REFRESH ---
        window.onload = function() {
            // Reset input CEK IP
            document.getElementById('logInput').value = '';
            document.getElementById('results').innerHTML = '<p>Tempelkan data Anda dan tekan "Klik Disini".</p>';
            
            // Reset input PREDIKSI BOLA
            document.getElementById('input').value = ''; 
            document.getElementById('output').innerHTML = '';
            document.getElementById('htmlOutput').value = '';
        };
        
        // --- 3. SCRIPT CEK IP (Fungsionalitas) ---
        const THRESHOLD = 3;
        function processData() {
            const rawData = document.getElementById('logInput').value;
            
            if (!rawData.trim()) {
                document.getElementById('results').innerHTML = "<p>‚ö†Ô∏è Harap tempelkan data terlebih dahulu.</p>";
                return;
            }
            
            const logData = parseRawData(rawData);
            const analysisResults = analyzeLoginData(logData);
            renderResults(analysisResults);
            
            // Tentukan status riwayat
            const highCountIPs = analysisResults.filter(item => item.userCount >= THRESHOLD);
            const status = highCountIPs.length > 0 
                ? `‚ùå Ditemukan ${highCountIPs.length} IP di atas batas (${THRESHOLD} User ID)`
                : '‚úÖ Normal';
            
            // Panggil fungsi BARU untuk menyimpan riwayat LENGKAP
            saveHistory(status, analysisResults); 
        }
        
        function parseRawData(rawData) {
            const lines = rawData.trim().split('\n');
            const parsedData = [];
            const ipRegex = /\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b/;

            lines.forEach(line => {
                const parts = line.trim().split(/\s{2,}|\t/);
                
                // Mencoba menemukan IP di mana saja, lalu ambil token pertama sebagai User ID
                const ipMatch = line.match(ipRegex);
                if (ipMatch) {
                    const ipLogin = ipMatch[0];
                    // Anggap User ID adalah kata/token pertama sebelum spasi/tab
                    const userId = line.trim().split(/\s+|\t/)[0];

                    if (userId && ipLogin) {
                        parsedData.push({ userId: userId.trim(), ipLogin });
                    }
                }
            });
            return parsedData;
        }
        
        function analyzeLoginData(data) {
            const ipCounts = {};
            data.forEach(log => {
                const ip = log.ipLogin;
                ipCounts[ip] = (ipCounts[ip] || 0) + 1;
            });
            const resultsArray = Object.keys(ipCounts).map(ip => ({
                ipAddress: ip,
                userCount: ipCounts[ip]
            }));
            resultsArray.sort((a, b) => b.userCount - a.userCount);
            return resultsArray;
        }
        
        function renderResults(results) {
            const resultsDiv = document.getElementById('results');
            if (results.length === 0) {
                resultsDiv.innerHTML = "<p>Tidak ada data valid yang ditemukan setelah diproses. Harap cek kembali format data yang ditempelkan.</p>";
                return;
            }
            let html = `<h2>Hasil Analisis: ${results.length} IP Unik</h2>`;
            html += `<p>Data diurutkan dari IP dengan User ID terbanyak. Status "CEK IP INI" jika hitungan >= ${THRESHOLD}.</p>`;
            html += '<table>';
            html += '<thead><tr><th>IP Address</th><th>Total User ID Unik</th><th>Status</th></tr></thead>';
            html += '<tbody>';
            results.forEach(item => {
                const isHigh = item.userCount >= THRESHOLD;
                const rowClass = isHigh ? 'class="high-count"' : '';
                html += `<tr ${rowClass}>`;
                html += `<td>${item.ipAddress}</td>`;
                html += `<td>${item.userCount}</td>`;
                html += `<td>${isHigh ? '‚ùå CEK IP INI' : '‚úÖ NORMAL'}</td>`;
                html += '</tr>';
            });
            html += '</tbody></table>';
            resultsDiv.innerHTML = html;
        }
        
        // --- 4. SCRIPT RIWAYAT (Fungsionalitas History - MODIFIED DATE/TIME FORMAT) ---
        
        // Fungsi pembantu untuk memastikan angka memiliki 2 digit (misal: 05)
        function padZero(num) {
            return num.toString().padStart(2, '0');
        }

        function getHistory() {
            try {
                const historyJson = localStorage.getItem(HISTORY_STORAGE_KEY);
                return historyJson ? JSON.parse(historyJson) : [];
            } catch (e) {
                console.error("Gagal memuat riwayat dari localStorage:", e);
                return [];
            }
        }
        
        function saveHistory(status, analysisResults) {
            const now = new Date();
            
            // Format Tanggal: DD Bulan YYYY (misal: 10 Desember 2025)
            const day = now.getDate();
            const year = now.getFullYear();
            const monthNames = [
                "Januari", "Februari", "Maret", "April", "Mei", "Juni", 
                "Juli", "Agustus", "September", "Oktober", "November", "Desember"
            ];
            const month = monthNames[now.getMonth()];
            const formattedDate = `${day} ${month} ${year}`;

            // Format Jam: HH:MM:SS (misal: 21:28:10)
            const hour = padZero(now.getHours());
            const minute = padZero(now.getMinutes());
            const second = padZero(now.getSeconds());
            const formattedTime = `${hour}:${minute}:${second}`;
            
            const newEntry = {
                id: Date.now(), 
                date: formattedDate,
                time: formattedTime,
                status: status,
                details: analysisResults
            };
            
            const history = getHistory();
            history.unshift(newEntry);
            
            const MAX_HISTORY = 50; 
            if (history.length > MAX_HISTORY) {
                history.length = MAX_HISTORY;
            }
            
            try {
                localStorage.setItem(HISTORY_STORAGE_KEY, JSON.stringify(history));
            } catch (e) {
                alert("Peringatan: Gagal menyimpan riwayat. Ruang penyimpanan browser mungkin penuh.");
                console.error("Gagal menyimpan riwayat:", e);
            }
        }
        
        function toggleDetails(id) {
            const detailElement = document.getElementById('details-' + id);
            if (detailElement) {
                detailElement.style.display = detailElement.style.display === 'table' ? 'none' : 'table';
            }
        }

        function loadHistory() {
            const history = getHistory();
            const historyDiv = document.getElementById('history-results');
            
            if (history.length === 0) {
                historyDiv.innerHTML = '<p>Belum ada riwayat pengecekan IP yang tersimpan.</p>';
                return;
            }
            
            let html = '<table>';
            html += '<thead><tr><th>Tanggal</th><th>Jam</th><th>Status Pengecekan</th><th>Detail</th></tr></thead>';
            html += '<tbody>';
            
            history.forEach(entry => {
                const rowClass = entry.status.startsWith('‚ùå') ? 'class="status-cek"' : 'class="status-normal"';
                html += `<tr ${rowClass}>`;
                html += `<td>${entry.date}</td>`;
                html += `<td>${entry.time}</td>`;
                html += `<td>${entry.status}</td>`;
                html += `<td><span class="history-detail-toggle" onclick="toggleDetails(${entry.id})">Lihat Detail (${entry.details.length} IP Unik)</span></td>`;
                html += '</tr>';
                
                // Tambahkan baris tersembunyi untuk detail
                html += `<tr><td colspan="4" style="padding: 0;">`;
                html += buildDetailTable(entry.id, entry.details);
                html += `</td></tr>`;
            });
            
            html += '</tbody></table>';
            historyDiv.innerHTML = html;
        }

        function buildDetailTable(id, details) {
            let detailHtml = `<table id="details-${id}" class="history-detail-table">`;
            detailHtml += '<thead><tr><th>IP Address</th><th>User ID Count</th><th>Status</th></tr></thead>';
            detailHtml += '<tbody>';
            
            details.forEach(detail => {
                const isHigh = detail.userCount >= THRESHOLD;
                const detailRowClass = isHigh ? 'class="high-count-detail"' : '';
                detailHtml += `<tr ${detailRowClass}>`;
                detailHtml += `<td>${detail.ipAddress}</td>`;
                detailHtml += `<td>${detail.userCount}</td>`;
                detailHtml += `<td>${isHigh ? '‚ùå CEK IP INI' : '‚úÖ NORMAL'}</td>`;
                detailHtml += '</tr>';
            });
            
            detailHtml += '</tbody></table>';
            return detailHtml;
        }
        
        function clearHistory() {
            if (confirm("Apakah Anda yakin ingin menghapus semua riwayat pengecekan IP?")) {
                localStorage.removeItem(HISTORY_STORAGE_KEY);
                loadHistory(); // Muat ulang tampilan setelah dihapus
                alert("Riwayat berhasil dihapus!");
            }
        }
        
        // --- 5. SCRIPT PREDIKSI BOLA (Fungsionalitas) ---
        function generateTable() {
            const input = document.getElementById('input').value.trim();
            const lines = input.split('\n').filter(l => l.trim() !== '');
            let outputHtmlContent = '';
            let leagueName = 'PREDIKSI TANPA JUDUL';
            let leagueData = {};
            // Regex diperbarui untuk lebih fleksibel pada spasi
            const matchRegex = /^(\d{2}\/\d{2})\s+(\d{2}:\d{2})\s+WIB\s+(.+?)\s+vs\s+(.+?)\s+([0-9\s:/-]+)$/i; 

            lines.forEach(line => {
                const match = line.match(matchRegex);
                if (match) {
                    const date = match[1];
                    const time = match[2];
                    const teamA = match[3].trim();
                    const teamB = match[4].trim();
                    const score = match[5].trim().replace(/\s*:\s*/g, ' - '); // Normalisasi skor ke format "X - Y"
                    
                    if (!leagueData[leagueName]) leagueData[leagueName] = [];
                    leagueData[leagueName].push([
                        `${date} ${time} WIB`,
                        `${teamA} vs ${teamB}`,
                        score
                    ]);
                } else {
                    // Jika baris tidak cocok dengan format pertandingan, anggap itu nama liga baru
                    const tempLeagueName = line.trim().toUpperCase();
                    if (tempLeagueName !== '') {
                        leagueName = tempLeagueName;
                        if (!leagueData[leagueName]) leagueData[leagueName] = [];
                    }
                }
            });

            for (const name in leagueData) {
                if (leagueData[name].length > 0) {
                    outputHtmlContent += `
                        <div class="match-block">
                          <h3 class="league-title">${name}</h3>
                          <table>
                            <thead>
                              <tr>
                                <th>Tanggal & Waktu</th>
                                <th>Pertandingan</th>
                                <th>Skor</th>
                              </tr>
                            </thead>
                            <tbody>
                    `;
                    leagueData[name].forEach(match => {
                        outputHtmlContent += `
                            <tr>
                              <td>${match[0]}</td>
                              <td>${match[1]}</td>
                              <td>${match[2]}</td>
                            </tr>
                        `;
                    });
                    outputHtmlContent += `</tbody></table></div>`;
                }
            }

            document.getElementById('output').innerHTML = outputHtmlContent;
            document.getElementById('htmlOutput').value = outputHtmlContent;
        }

        function copyHTML() {
            const html = document.getElementById('htmlOutput');
            html.select();
            document.execCommand('copy');
            alert('Semua HTML berhasil disalin!');
        }
    </script>
</body>
</html>
