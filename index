<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Analisis IP Login - Naga Background</title>
    <style>
        /* --- CSS MODIFIKASI UNTUK BACKGROUND GAMBAR NAGA --- */
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            
            background-image: url('https://i.postimg.cc/g2RjrBN2/image.png'); /* MENGGUNAKAN NAMA FILE ASLI ANDA */
            background-size: cover;             /* Gambar menutupi seluruh halaman */
            background-position: center center; /* Pusatkan gambar */
            background-repeat: no-repeat;       /* Jangan ulangi gambar */
            background-attachment: fixed;       /* Gambar tetap di tempat saat discroll */
        }
        /* -------------------------------------------------- */
        
        textarea { width: 100%; height: 200px; padding: 10px; box-sizing: border-box; margin-bottom: 10px; }
        button { padding: 10px 20px; background-color: #28a745; color: white; border: none; cursor: pointer; margin-bottom: 20px; }
        
        /* Gaya untuk konten agar menonjol di atas gambar background */
        #content-box {
            max-width: 1000px; /* Batasi lebar agar tidak terlalu lebar */
            margin: 0 auto; /* Pusatkan content-box di tengah halaman */
            background-color: rgba(255, 255, 255, 0.95); /* Latar belakang PUTIH SEMI-TRANSPARAN yang lebih solid agar teks jelas */
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); /* Bayangan lebih kuat */
        }

        h1 { color: #222; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); }
        p { color: #444; } 
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #e0e6ed; }
        .high-count { background-color: #ffcccc; font-weight: bold; }
    </style>
</head>
<body>
    
    <div id="content-box">
        <h1>üîç Dashboard Analisis IP Login</h1>

        <p>‚úÖTempelkan data Anda di bawah ini. Tekan F5 untuk membersihkan input.</p>

        <textarea id="logInput" placeholder="Tempelkan data Anda di sini..."></textarea>
        
        <button onclick="processData()">Klik Disini</button>

        <div id="results">
            <p>Tempelkan data Anda dan tekan "Klik Disini".</p>
        </div>
    </div>

    <script>
        // --- FITUR RESET INPUT SAAT REFRESH ---
        window.onload = function() {
            document.getElementById('logInput').value = '';
            document.getElementById('results').innerHTML = '<p>Tempelkan data Anda dan tekan "Klik Disini".</p>';
        };
        // ------------------------------------------
        
        const THRESHOLD = 3; 

        function processData() {
            const rawData = document.getElementById('logInput').value;
            
            if (!rawData.trim()) {
                document.getElementById('results').innerHTML = "<p>‚ö†Ô∏è Harap tempelkan data terlebih dahulu.</p>";
                return;
            }

            const logData = parseRawData(rawData);
            const analysisResults = analyzeLoginData(logData);
            renderResults(analysisResults);
        }

        function parseRawData(rawData) {
            const lines = rawData.trim().split('\n');
            const parsedData = [];

            lines.forEach(line => {
                // Menggunakan Regular Expression untuk memisahkan kolom berdasarkan satu atau lebih spasi/tab.
                const parts = line.trim().split(/\s{2,}|\t/); 
                
                if (parts.length >= 3) {
                    const userId = parts[0].trim(); // Kolom 1
                    const ipLogin = parts[2].trim(); // Kolom 3

                    if (userId && ipLogin) {
                        parsedData.push({ userId, ipLogin });
                    }
                }
            });
            return parsedData;
        }

        function analyzeLoginData(data) {
            const ipCounts = {}; 
            data.forEach(log => {
                const ip = log.ipLogin;
                ipCounts[ip] = (ipCounts[ip] || 0) + 1;
            });

            const resultsArray = Object.keys(ipCounts).map(ip => ({
                ipAddress: ip,
                userCount: ipCounts[ip]
            }));

            resultsArray.sort((a, b) => b.userCount - a.userCount);
            return resultsArray;
        }

        function renderResults(results) {
            const resultsDiv = document.getElementById('results');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = "<p>Tidak ada data valid yang ditemukan setelah diproses. Harap cek kembali format data yang ditempelkan.</p>";
                return;
            }

            let html = `<h2>Hasil Analisis: ${results.length} IP Unik</h2>`;
            html += `<p>Data diurutkan dari IP dengan User ID terbanyak. Status "CEK IP INI" jika hitungan >= ${THRESHOLD}.</p>`;
            html += '<table>';
            html += '<thead><tr><th>IP Address</th><th>Total User ID Unik</th><th>Status</th></tr></thead>';
            html += '<tbody>';

            results.forEach(item => {
                const isHigh = item.userCount >= THRESHOLD;
                const rowClass = isHigh ? 'class="high-count"' : '';

                html += `<tr ${rowClass}>`;
                html += `<td>${item.ipAddress}</td>`;
                html += `<td>${item.userCount}</td>`;
                html += `<td>${isHigh ? '‚ùå CEK IP INI' : '‚úÖ NORMAL'}</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            resultsDiv.innerHTML = html;
        }
    </script>

</body>
</html>
